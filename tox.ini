# tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
# TODO: Add py310 when required packages support it.
envlist = coverage-clean, py36, py37, py38, py39, coverage-combine
skip_missing_interpreters=true
isolated_build = True

[tox:.package]
# note tox will use the same python version as under what tox is installed to package
# so unless this is python 3 you can require a given python version for the packaging
# environment via the basepython key
basepython = python3

[testenv]
; For some reason, with poetry, tox testing always fails unless the environment is recreated.
recreate = True
deps =
    poetry
    coverage
    pytest
extras =
    poetry
    pytest
commands =
    poetry install -v
    coverage run --parallel -m pytest {posargs}
setenv =
    PYTHONPATH=src
    PYENV=none

[testenv:coverage-clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:coverage-combine]
deps = coverage
skip_install = true
commands =
    coverage combine
    coverage xml
depends =
    py36
    py37
    py38
    py39
    py310
    pypy3

# Until I'm ready to deal with the deprecation warnings.
[pytest]
addopts = -p no:warnings
