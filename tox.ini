# tox (https://tox.readthedocs.io/) is a tool for running tests
# in multiple virtualenvs. This configuration file will run the
# test suite on all supported python versions. To use it, "pip install tox"
# and then run "tox" from this directory.

[tox]
envlist = py36, py37, py38, py39 #, py310 #, coverage-report # Coverage-report doesn't work yet.
skip_missing_interpreters=true
isolated_build = True

[tox:.package]
# note tox will use the same python version as under what tox is installed to package
# so unless this is python 3 you can require a given python version for the packaging
# environment via the basepython key
basepython = python3

[testenv]
; For some reason, with poetry, tox testing always fails unless the environment is recreated.
recreate = True
deps =
    poetry
    pytest
extras =
    poetry
    pytest
commands =
    poetry install -v
    pytest {posargs}

setenv =
    PYTHONPATH=src
    PYENV=none

[testenv:coverage-report]
deps = coverage
skip_install = true
parallel_show_output = true
depends =
    py36
    py37
    py38
    py39
    py310
    pypy3
commands =
    coverage combine
    coverage report
